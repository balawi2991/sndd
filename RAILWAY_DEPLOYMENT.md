# ğŸš‚ Railway Deployment Guide - Sanad

## Ø¯Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù†Ø´Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù„Ù‰ Railway

---

## ğŸ“‹ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡

### **Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª**
- âœ… Ø­Ø³Ø§Ø¨ GitHub
- âœ… Ø­Ø³Ø§Ø¨ Railway (Ù…Ø¬Ø§Ù†ÙŠ)
- âœ… DeepSeek API Key
- âœ… OpenAI API Key
- âœ… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù„Ù‰ GitHub

---

## ğŸ¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: ØªØ¬Ù‡ÙŠØ² GitHub Repository**

#### **1.1 Ø¥Ù†Ø´Ø§Ø¡ Repository**
```bash
# Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‚Ø¯ Ø£Ù†Ø´Ø£Øª repo Ø¨Ø¹Ø¯
git init
git add .
git commit -m "Initial commit: Sanad AI Chat Platform"
git branch -M main
git remote add origin https://github.com/balawi2991/sanadbot.git
git push -u origin main
```

#### **1.2 Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù‡Ù…Ø©**
ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯:
- âœ… `server/railway.json`
- âœ… `server/Procfile`
- âœ… `server/.env.example`
- âœ… `.gitignore` (Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ .env)

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø¥Ø¹Ø¯Ø§Ø¯ Railway Project**

#### **2.1 Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Railway**
1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰: https://railway.app
2. Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ù€ GitHub
3. Ø§Ø±Ø¨Ø· Ø­Ø³Ø§Ø¨Ùƒ

#### **2.2 Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯**
1. Dashboard â†’ **"New Project"**
2. Ø§Ø®ØªØ± **"Deploy from GitHub repo"**
3. Ø§Ø®ØªØ± `balawi2991/sanadbot`
4. Railway Ø³ÙŠØ¨Ø¯Ø£ Ø¨Ù€ auto-detect

#### **2.3 ØªÙƒÙˆÙŠÙ† Backend Service**

**ÙÙŠ Railway Dashboard:**

1. **Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Settings**
   - Service Name: `sanad-backend`
   - Root Directory: `server`
   
2. **Build Settings**
   - Build Command: `npm install && npm run build`
   - Start Command: `npm start`
   
3. **Deploy Trigger**
   - Branch: `main`
   - Auto-deploy: âœ… Enabled

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø¥Ø¶Ø§ÙØ© PostgreSQL Database**

#### **3.1 Ø¥Ø¶Ø§ÙØ© Database Service**
1. ÙÙŠ Project â†’ **"New"** â†’ **"Database"** â†’ **"PostgreSQL"**
2. Railway Ø³ÙŠÙ†Ø´Ø¦ database ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
3. Ø³ÙŠØ¸Ù‡Ø± `DATABASE_URL` ÙÙŠ Variables

#### **3.2 ØªØ«Ø¨ÙŠØª pgvector Extension**

**Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 1: Ù…Ù† Railway Dashboard**
```bash
# ÙÙŠ Railway Dashboard
# Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ PostgreSQL service
# Ø§Ø¶ØºØ· "Connect"
# Ø§Ø®ØªØ± "psql"

# ÙÙŠ psql terminal:
CREATE EXTENSION vector;
\q
```

**Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 2: Ù…Ù† Local Machine**
```bash
# Install Railway CLI
npm install -g @railway/cli

# Login
railway login

# Link to project
railway link

# Connect to database
railway connect postgresql

# ÙÙŠ psql:
CREATE EXTENSION vector;
\q
```

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: ØªØ´ØºÙŠÙ„ Database Migrations**

#### **4.1 Ù…Ù† Railway CLI**
```bash
# ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ÙÙŠ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
cd /path/to/sanadbot

# Run schema
railway run psql $DATABASE_URL < server/src/db/schema.sql

# Run updates
railway run psql $DATABASE_URL < server/src/db/schema-updates.sql
```

#### **4.2 Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ø¬Ø§Ø­**
```bash
railway connect postgresql

# ÙÙŠ psql:
\dt  # Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
\q
```

ÙŠØ¬Ø¨ Ø£Ù† ØªØ±Ù‰:
- âœ… users
- âœ… conversations
- âœ… messages
- âœ… training_materials
- âœ… chunks
- âœ… agents
- âœ… subscription_tiers
- âœ… user_subscriptions
- âœ… daily_usage
- âœ… audit_logs

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: Ø¥Ø¶Ø§ÙØ© Environment Variables**

#### **5.1 ÙÙŠ Railway Dashboard**

Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Backend Service â†’ **Variables** â†’ **Raw Editor**

```env
# Database (Auto-generated by Railway)
DATABASE_URL=${{Postgres.DATABASE_URL}}

# AI APIs (Required)
DEEPSEEK_API_KEY=sk-your-deepseek-key-here
OPENAI_API_KEY=sk-your-openai-key-here

# Security (Required - Generate strong key)
JWT_SECRET=your-super-secret-jwt-key-min-32-characters-long

# Server Configuration
PORT=3001
NODE_ENV=production

# CORS (Update after frontend deployment)
CORS_ORIGIN=https://your-frontend-url.vercel.app
```

#### **5.2 ØªÙˆÙ„ÙŠØ¯ JWT Secret**
```bash
# ÙÙŠ terminal:
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6: Deploy Backend**

#### **6.1 Trigger Deployment**
1. Railway Ø³ÙŠØ¨Ø¯Ø£ deploy ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
2. Ø±Ø§Ù‚Ø¨ Logs ÙÙŠ Dashboard
3. Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠØµØ¨Ø­ Status: **"Active"**

#### **6.2 Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Backend URL**
1. ÙÙŠ Backend Service â†’ **Settings**
2. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ **Networking**
3. Ø§Ø¶ØºØ· **"Generate Domain"**
4. Ø³ÙŠØ¹Ø·ÙŠÙƒ URL Ù…Ø«Ù„: `sanad-backend.railway.app`

#### **6.3 Ø§Ø®ØªØ¨Ø§Ø± Backend**
```bash
# Health check
curl https://sanad-backend.railway.app/health

# ÙŠØ¬Ø¨ Ø£Ù† ØªØ±Ù‰:
# {"status":"ok","timestamp":"...","uptime":...}
```

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 7: Deploy Frontend (Vercel)**

#### **7.1 Ø¥Ù†Ø´Ø§Ø¡ Vercel Project**
1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰: https://vercel.com
2. Import `balawi2991/sanadbot`
3. **Root Directory**: Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±Øº (/)

#### **7.2 Environment Variables**
```env
VITE_API_URL=https://sanad-backend.railway.app/api
```

#### **7.3 Deploy**
- Vercel Ø³ÙŠØ¨Ù†ÙŠ ÙˆÙŠØ±ÙØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- Ø³ÙŠØ¹Ø·ÙŠÙƒ URL Ù…Ø«Ù„: `sanadbot.vercel.app`

#### **7.4 ØªØ­Ø¯ÙŠØ« CORS ÙÙŠ Railway**
1. Ø§Ø±Ø¬Ø¹ Ù„Ù€ Railway Backend
2. Variables â†’ `CORS_ORIGIN`
3. ØºÙŠØ±Ù‡ Ø¥Ù„Ù‰: `https://sanadbot.vercel.app`
4. Redeploy Backend

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 8: Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ**

#### **8.1 Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Database**
```bash
railway connect postgresql
```

#### **8.2 Ø¥Ù†Ø´Ø§Ø¡ User**
```sql
-- Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù…
INSERT INTO users (id, email, name)
VALUES ('test-user-id', 'admin@sanad.com', 'Admin User');

-- Ø¥Ù†Ø´Ø§Ø¡ subscription (Free tier)
INSERT INTO user_subscriptions (user_id, tier_id, status)
SELECT 'test-user-id', id, 'active'
FROM subscription_tiers
WHERE name = 'free';

-- Ø§Ù„ØªØ­Ù‚Ù‚
SELECT * FROM users;
SELECT * FROM user_subscriptions;
\q
```

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 9: Ø¥Ù†Ø´Ø§Ø¡ Agent & API Key**

#### **9.1 Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ JWT Token**

**Ù…Ø¤Ù‚ØªØ§Ù‹** (Ø­ØªÙ‰ Ù†Ø¶ÙŠÙ login):
```javascript
// ÙÙŠ browser console Ø¹Ù„Ù‰ frontend
const jwt = require('jsonwebtoken');
const token = jwt.sign(
  { id: 'test-user-id', email: 'admin@sanad.com' },
  'your-jwt-secret',
  { expiresIn: '7d' }
);
console.log(token);
```

Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù…: https://jwt.io

#### **9.2 Ø¥Ù†Ø´Ø§Ø¡ Agent**
```bash
curl -X POST https://sanad-backend.railway.app/api/agents \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name": "My First Agent"}'
```

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "...",
    "name": "My First Agent",
    "apiKey": "agent_xxxxxxxxxxxxxxxxx",
    "isActive": true
  }
}
```

**Ø§Ø­ÙØ¸ API Key!** Ø³ØªØ­ØªØ§Ø¬Ù‡ Ù„Ù„Ù€ widget.

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 10: Ø±ÙØ¹ Ù…Ø§Ø¯Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©**

#### **10.1 Ø±ÙØ¹ Ù†Øµ**
```bash
curl -X POST https://sanad-backend.railway.app/api/materials/text \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "text",
    "title": "Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…",
    "content": "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Sanad! Ù‡Ø°Ø§ Ù†Ø¸Ø§Ù… Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªÙ‚Ø¯Ù…..."
  }'
```

#### **10.2 Ø±ÙØ¹ Ù…Ù„Ù**
```bash
curl -X POST https://sanad-backend.railway.app/api/materials/upload \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "file=@/path/to/document.pdf" \
  -F "title=Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬"
```

---

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 11: Ø§Ø®ØªØ¨Ø§Ø± Chat**

#### **11.1 Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©**
```bash
curl -X POST https://sanad-backend.railway.app/api/chat \
  -H "X-API-Key: agent_xxxxxxxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ"
  }'
```

#### **11.2 Ù…Ù† Frontend**
1. Ø§ÙØªØ­ `https://sanadbot.vercel.app`
2. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø£ÙŠ ØµÙØ­Ø©
3. Ø§ÙƒØªØ¨ ÙÙŠ Chat Widget
4. ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø±Ø¯ Ù…Ù† AI

---

## ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©

### **Custom Domain (Railway)**

#### **Ù„Ù„Ù€ Backend**
1. Railway Service â†’ Settings â†’ Networking
2. Custom Domain â†’ Add Domain
3. Ø£Ø¶Ù: `api.yourdomain.com`
4. Ø£Ø¶Ù CNAME record ÙÙŠ DNS:
   ```
   api.yourdomain.com â†’ sanad-backend.railway.app
   ```

#### **Ù„Ù„Ù€ Frontend (Vercel)**
1. Vercel Project â†’ Settings â†’ Domains
2. Add Domain: `yourdomain.com`
3. Ø§ØªØ¨Ø¹ ØªØ¹Ù„ÙŠÙ…Ø§Øª DNS

### **File Storage (Railway Volumes)**

Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±ÙŠØ¯ persistent storage:

1. Railway Service â†’ Settings â†’ Volumes
2. Add Volume:
   - Mount Path: `/app/uploads`
   - Size: 1GB (Ø£Ùˆ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©)

### **Redis for Rate Limiting**

1. Railway â†’ New â†’ Database â†’ Redis
2. Ø£Ø¶Ù `REDIS_URL` ÙÙŠ Variables
3. Ø­Ø¯Ù‘Ø« rate limiter ÙÙŠ `server/src/middleware/rateLimiter.ts`

---

## ğŸ“Š Monitoring & Logs

### **Ø¹Ø±Ø¶ Logs**
```bash
# Ù…Ù† Railway CLI
railway logs

# Ø£Ùˆ Ù…Ù† Dashboard
# Service â†’ Logs tab
```

### **Metrics**
- Railway Dashboard â†’ Service â†’ Metrics
- CPU, Memory, Network usage

---

## ğŸ› Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„

### **Problem: Build Failed**
```bash
# Check logs
railway logs

# Common issues:
# 1. Missing dependencies â†’ npm install
# 2. TypeScript errors â†’ npm run build locally first
# 3. Wrong root directory â†’ Check Settings
```

### **Problem: Database Connection Failed**
```bash
# Verify DATABASE_URL
railway variables

# Test connection
railway connect postgresql
```

### **Problem: pgvector Extension Missing**
```bash
railway connect postgresql
CREATE EXTENSION vector;
\q
```

### **Problem: CORS Error**
```bash
# Update CORS_ORIGIN in Railway
# Must match frontend URL exactly
CORS_ORIGIN=https://sanadbot.vercel.app
```

### **Problem: API Keys Not Working**
```sql
-- Check agents table
railway connect postgresql
SELECT * FROM agents;

-- Verify API key format
-- Should start with: agent_
```

---

## âœ… Checklist Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ

### **Backend**
- [ ] Railway project created
- [ ] PostgreSQL added
- [ ] pgvector installed
- [ ] Migrations run successfully
- [ ] Environment variables set
- [ ] Backend deployed (Status: Active)
- [ ] Health check passing
- [ ] Domain generated

### **Database**
- [ ] All tables created
- [ ] Test user created
- [ ] Subscription created
- [ ] Agent created
- [ ] API key generated

### **Frontend**
- [ ] Vercel project created
- [ ] VITE_API_URL set
- [ ] Deployed successfully
- [ ] Can access website

### **Testing**
- [ ] Material uploaded
- [ ] Chat message sent
- [ ] Response received
- [ ] Conversation saved
- [ ] User isolation verified

---

## ğŸ¯ Next Steps

Ø¨Ø¹Ø¯ Deployment Ø§Ù„Ù†Ø§Ø¬Ø­:

1. **Ø¥Ø¶Ø§ÙØ© User Registration**
   - Login/Signup pages
   - Password hashing
   - Email verification

2. **ØªØ­Ø³ÙŠÙ† Upload UI**
   - Drag & drop
   - Progress bars
   - Material management

3. **Analytics Dashboard**
   - Usage statistics
   - Popular questions
   - Response times

4. **Custom Domain**
   - Professional domain
   - SSL certificate
   - CDN setup

---

## ğŸ“ Ø§Ù„Ø¯Ø¹Ù…

### **Railway Issues**
- ğŸ“– Docs: https://docs.railway.app
- ğŸ’¬ Discord: https://discord.gg/railway
- ğŸ› GitHub: https://github.com/railwayapp/railway

### **Project Issues**
- ğŸ› GitHub Issues: https://github.com/balawi2991/sanadbot/issues

---

## ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!

Ø¥Ø°Ø§ ÙˆØµÙ„Øª Ù‡Ù†Ø§ØŒ Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø¢Ù† **Live on Production!** ğŸš€

**URL Backend**: `https://sanad-backend.railway.app`
**URL Frontend**: `https://sanadbot.vercel.app`

---

**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù„Ù„Ù€ Deployment**: 30-45 Ø¯Ù‚ÙŠÙ‚Ø©

**Ø§Ù„Ø­Ø§Ù„Ø©**: ğŸŸ¢ **Ready for Production!**
