# ğŸš‚ Railway Deployment Guide - Sanad (MintChat)

## ğŸ“‹ Overview

Ù‡Ø°Ø§ Ø§Ù„Ø¯Ù„ÙŠÙ„ ÙŠØ´Ø±Ø­ ÙƒÙŠÙÙŠØ© Ù†Ø´Ø± Sanad Ø¹Ù„Ù‰ Railway Ù…Ø¹:
- âœ… Backend + Frontend ÙÙŠ service ÙˆØ§Ø­Ø¯
- âœ… PostgreSQL database Ø¹Ù„Ù‰ Railway
- âœ… Environment variables Ø¢Ù…Ù†Ø©
- âœ… Auto-deploy Ù…Ù† GitHub

---

## ğŸ¯ Architecture

```
Railway Project: Sanad
â”œâ”€â”€ Service 1: Web App (Backend + Frontend)
â”‚   â”œâ”€â”€ Port 3001
â”‚   â”œâ”€â”€ Serves API at /api/*
â”‚   â””â”€â”€ Serves Frontend at /*
â””â”€â”€ Service 2: PostgreSQL (Railway Plugin)
    â””â”€â”€ Automatic connection string
```

---

## ğŸ“ Pre-requisites

1. âœ… Ø­Ø³Ø§Ø¨ Ø¹Ù„Ù‰ [Railway](https://railway.app)
2. âœ… Ø­Ø³Ø§Ø¨ GitHub
3. âœ… DeepSeek API Key
4. âœ… OpenAI API Key
5. âœ… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù„Ù‰ GitHub repository

---

## ğŸš€ Deployment Steps

### **Step 1: Push to GitHub**

```bash
# Initialize git (if not done)
git init
git add .
git commit -m "Initial commit - Ready for Railway"

# Create GitHub repo and push
git remote add origin https://github.com/YOUR_USERNAME/sanad.git
git branch -M main
git push -u origin main
```

### **Step 2: Create Railway Project**

1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ [Railway Dashboard](https://railway.app/dashboard)
2. Ø§Ø¶ØºØ· **"New Project"**
3. Ø§Ø®ØªØ± **"Deploy from GitHub repo"**
4. Ø§Ø®ØªØ± repository: `sanad`
5. Railway Ø³ÙŠÙƒØªØ´Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø£Ù†Ù‡ Node.js project

### **Step 3: Add PostgreSQL**

1. ÙÙŠ Railway projectØŒ Ø§Ø¶ØºØ· **"+ New"**
2. Ø§Ø®ØªØ± **"Database"**
3. Ø§Ø®ØªØ± **"PostgreSQL"**
4. Railway Ø³ÙŠÙ†Ø´Ø¦ database ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
5. Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ `DATABASE_URL` ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹

### **Step 4: Configure Environment Variables**

ÙÙŠ Railway project settingsØŒ Ø£Ø¶Ù Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:

#### **Required Variables:**

```env
# Node Environment
NODE_ENV=production

# JWT Secret (Generate a strong random string)
JWT_SECRET=your-super-secret-jwt-key-min-32-characters-long
JWT_EXPIRES_IN=7d
REFRESH_TOKEN_EXPIRES_IN=30d

# DeepSeek API
DEEPSEEK_API_KEY=sk-your-deepseek-api-key
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-chat
DEEPSEEK_TEMPERATURE=0.7
DEEPSEEK_MAX_TOKENS=1000
DEEPSEEK_TIMEOUT=30000

# OpenAI API (for embeddings)
OPENAI_API_KEY=sk-your-openai-api-key

# Database (Auto-generated by Railway)
DATABASE_URL=${{Postgres.DATABASE_URL}}

# CORS (Railway provides this automatically)
CORS_ORIGIN=https://your-app.up.railway.app

# Rate Limiting
RATE_LIMIT_PER_MINUTE=10
RATE_LIMIT_PER_HOUR=100
RATE_LIMIT_PER_DAY=500

# RAG Configuration
RAG_CHUNK_SIZE=750
RAG_CHUNK_OVERLAP=100
RAG_TOP_K=10
RAG_RERANK_TOP=3
RAG_SIMILARITY_THRESHOLD=0.7
```

#### **ÙƒÙŠÙÙŠØ© ØªÙˆÙ„ÙŠØ¯ JWT_SECRET:**

```bash
# ÙÙŠ terminal
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### **Step 5: Configure Build Settings**

Railway Ø³ÙŠÙƒØªØ´Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† `railway.json`:

```json
{
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "npm run build:all"
  },
  "deploy": {
    "startCommand": "npm start",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

### **Step 6: Setup Database Schema**

Ø¨Ø¹Ø¯ deploymentØŒ Ù‚Ù… Ø¨ØªØ´ØºÙŠÙ„ schema:

#### **Option A: Ù…Ù† Railway CLI**

```bash
# Install Railway CLI
npm install -g @railway/cli

# Login
railway login

# Link to project
railway link

# Run schema
railway run psql $DATABASE_URL < server/src/db/schema.sql
```

#### **Option B: Ù…Ù† Railway Dashboard**

1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ PostgreSQL service
2. Ø§Ø¶ØºØ· **"Connect"**
3. Ø§Ø®ØªØ± **"psql"**
4. Ø§Ù†Ø³Ø® schema.sql content ÙˆØ§Ù„ØµÙ‚Ù‡

### **Step 7: Deploy!**

1. Railway Ø³ÙŠØ¨Ø¯Ø£ build ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
2. Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠÙ†ØªÙ‡ÙŠ build (~3-5 Ø¯Ù‚Ø§Ø¦Ù‚)
3. Railway Ø³ÙŠØ¹Ø·ÙŠÙƒ URL: `https://your-app.up.railway.app`

---

## ğŸ”§ Post-Deployment

### **1. Test Health Endpoint**

```bash
curl https://your-app.up.railway.app/health
```

ÙŠØ¬Ø¨ Ø£Ù† ØªØ±Ù‰:
```json
{
  "status": "ok",
  "timestamp": "...",
  "uptime": 123
}
```

### **2. Test Frontend**

Ø§ÙØªØ­ `https://your-app.up.railway.app` ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­

### **3. Create First User**

```bash
curl -X POST https://your-app.up.railway.app/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@example.com",
    "name": "Admin",
    "password": "YourSecurePassword123!"
  }'
```

### **4. Add Training Material**

```bash
# Login first to get token
TOKEN="your-access-token-from-login"

curl -X POST https://your-app.up.railway.app/api/materials \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "type": "text",
    "title": "Welcome Guide",
    "content": "Welcome to Sanad! This is your AI assistant..."
  }'
```

---

## ğŸ“Š Monitoring

### **Railway Dashboard**

- **Metrics**: CPU, Memory, Network
- **Logs**: Real-time logs
- **Deployments**: History of all deployments

### **Custom Monitoring**

```bash
# View logs
railway logs

# Follow logs
railway logs --follow
```

---

## ğŸ”„ Updates & Redeployment

### **Auto-Deploy (Recommended)**

Railway auto-deploys Ø¹Ù†Ø¯ push Ø¥Ù„Ù‰ GitHub:

```bash
git add .
git commit -m "Update feature"
git push origin main
# Railway will auto-deploy
```

### **Manual Deploy**

```bash
railway up
```

---

## ğŸ’° Cost Estimation

### **Hobby Plan (Free)**
- âœ… $5 free credits/month
- âœ… Good for testing
- âš ï¸ Limited resources

### **Developer Plan ($20/month)**
- âœ… $20 credits included
- âœ… Better performance
- âœ… More resources

### **Estimated Monthly Cost:**
- **Web Service**: ~$5-10
- **PostgreSQL**: ~$5
- **Total**: ~$10-15/month

---

## ğŸ› Troubleshooting

### **Build Fails**

```bash
# Check logs
railway logs

# Common issues:
# 1. Missing dependencies
npm install

# 2. TypeScript errors
npm run typecheck

# 3. Build command fails
npm run build:all
```

### **Database Connection Error**

```bash
# Verify DATABASE_URL
railway variables

# Test connection
railway run psql $DATABASE_URL -c "SELECT 1"
```

### **CORS Error**

ØªØ£ÙƒØ¯ Ù…Ù† `CORS_ORIGIN` ÙÙŠ environment variables:
```env
CORS_ORIGIN=https://your-app.up.railway.app
```

### **API Keys Invalid**

ØªØ­Ù‚Ù‚ Ù…Ù†:
1. âœ… DEEPSEEK_API_KEY ØµØ­ÙŠØ­
2. âœ… OPENAI_API_KEY ØµØ­ÙŠØ­
3. âœ… API keys Ù„Ù‡Ø§ credits ÙƒØ§ÙÙŠØ©

---

## ğŸ”’ Security Checklist

- [ ] JWT_SECRET Ù‚ÙˆÙŠ ÙˆØ¹Ø´ÙˆØ§Ø¦ÙŠ (32+ characters)
- [ ] API keys ÙÙŠ environment variables ÙÙ‚Ø·
- [ ] CORS_ORIGIN Ù…Ø­Ø¯Ø¯ Ø¨Ø¯Ù‚Ø©
- [ ] Rate limiting Ù…ÙØ¹Ù‘Ù„
- [ ] Helmet middleware Ù…ÙØ¹Ù‘Ù„
- [ ] HTTPS only (Railway ÙŠÙˆÙØ±Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
- [ ] Database backups Ù…ÙØ¹Ù‘Ù„Ø©

---

## ğŸ“š Useful Commands

```bash
# Railway CLI
railway login              # Login to Railway
railway link               # Link to project
railway status             # Check status
railway logs               # View logs
railway logs --follow      # Follow logs
railway variables          # List env vars
railway run <command>      # Run command in Railway
railway open               # Open in browser

# Database
railway run psql $DATABASE_URL                    # Connect to DB
railway run psql $DATABASE_URL -c "SELECT 1"     # Run query
railway run psql $DATABASE_URL < schema.sql      # Run schema
```

---

## ğŸ¯ Next Steps

1. âœ… Setup custom domain
2. âœ… Configure email notifications
3. âœ… Setup monitoring alerts
4. âœ… Configure backups
5. âœ… Add CI/CD tests

---

## ğŸ“ Support

- **Railway Docs**: https://docs.railway.app
- **Railway Discord**: https://discord.gg/railway
- **Railway Status**: https://status.railway.app

---

## âœ… Deployment Checklist

- [ ] Code pushed to GitHub
- [ ] Railway project created
- [ ] PostgreSQL added
- [ ] Environment variables configured
- [ ] Database schema applied
- [ ] Health endpoint working
- [ ] Frontend accessible
- [ ] First user created
- [ ] Training material added
- [ ] Chat widget working
- [ ] Monitoring setup

---

**ğŸ‰ Congratulations! Your Sanad app is now live on Railway!**

**URL**: `https://your-app.up.railway.app`
